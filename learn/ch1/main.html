<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pembelajaran Slide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        .fade-enter {
            opacity: 0;
        }
        .fade-enter-active {
            opacity: 1;
            transition: opacity 300ms;
        }
        .fade-exit {
            opacity: 1;
        }
        .fade-exit-active {
            opacity: 0;
            transition: opacity 300ms;
        }
    </style>
</head>
<body style="background-color: #f5f8fa; color: #040607;">
    <!-- Progress Bar -->
    <div class="w-full h-3" style="background-color: #e0e0e0;">
        <div id="progress-bar" class="h-full transition-all duration-500" style="width: 0%; background-color: #528cbd;"></div>
    </div>

    <!-- Main Content -->
    <div id="content-container" class="min-h-screen flex flex-col items-center justify-center p-8">
        <div class="max-w-3xl w-full">
            <!-- Content Text -->
            <div id="slide-content" class="text-lg leading-relaxed mb-8"></div>

            <!-- Question Section -->
            <div id="question-section" class="mb-8 hidden">
                <h3 id="question-text" class="text-xl font-semibold mb-4"></h3>
                <div id="options-container" class="space-y-3"></div>
                
                <!-- Feedback -->
                <div id="feedback" class="mt-4 p-4 rounded-lg flex items-center gap-2 hidden"></div>
            </div>

            <!-- Graph Link -->
            <div id="graph-section" class="mb-8 hidden">
                <a id="graph-link" href="#" target="_blank" rel="noopener noreferrer" 
                   class="inline-block px-6 py-3 rounded-lg text-white font-medium transition-colors"
                   style="background-color: #528cbd;">
                    Buka Grafik Desmos
                </a>
            </div>

            <!-- Next Button -->
            <div class="flex justify-end">
                <button id="next-btn" 
                        class="px-8 py-3 rounded-lg text-white font-medium transition-all cursor-not-allowed opacity-50"
                        style="background-color: #8eb7db;">
                    Next
                </button>
            </div>
        </div>
    </div>

    <script>
        let stage = 1;
        
        const slidesData = [
            {
                "id": 1,
                "content": "Bab: Turunan<br>Bagian: Definisi Turunan<br>Turunan mempelajari bagaimana fungsi berubah. Turunan adalah laju perubahan sesaat atau kemiringan garis singgung pada suatu titik.",
                "type": "none",
                "question": "none"
            },
            {
                "id": 2,
                "content": "Turunan adalah kemiringan dari garis singgung pada suatu titik pada kurva fungsi. Misalnya, jika kita memiliki fungsi posisi terhadap waktu. Anda dapat memahami definisi itu lebih baik dengan melihat grafik di bawah ini.",
                "type": "graph",
                "graph": "https://www.desmos.com/calculator/oevz4xoiuo?lang=id",
                "question": "multiple-choice",
                "soal": "Dari grafik di atas, apa arti dari turunan pada titik tertentu?",
                "opsi": [
                    "Laju perubahan posisi terhadap waktu pada titik tersebut.",
                    "Posisi awal benda pada waktu nol.",
                    "Waktu yang dibutuhkan untuk mencapai posisi tertentu.",
                    "Jumlah total jarak yang ditempuh benda."
                ],
                "jawaban": "Laju perubahan posisi terhadap waktu pada titik tersebut."
            },
            {
                "id": 3,
                "content": "Setel nilai a = 1. Berapakah kemiringannya jika h = 1?",
                "type": "graph",
                "graph": "https://www.desmos.com/calculator/oevz4xoiuo?lang=id",
                "question": "multiple-choice",
                "opsi": ["1", "2", "3", "4"],
                "jawaban": "3"
            },
            {
                "id": 4,
                "content": "Setel nilai a = 1. Berapakah kemiringannya jika h = 0,1?",
                "type": "graph",
                "graph": "https://www.desmos.com/calculator/oevz4xoiuo?lang=id",
                "question": "multiple-choice",
                "opsi": ["2,1", "2,2", "2,3", "2,4"],
                "jawaban": "2,1"
            },
            {
                "id": 5,
                "content": "Setel nilai a = 1. Berapakah kemiringannya jika h = 0,0001?",
                "type": "graph",
                "graph": "https://www.desmos.com/calculator/oevz4xoiuo?lang=id",
                "question": "multiple-choice",
                "opsi": ["2,1", "2,01", "2,001", "2,0001"],
                "jawaban": "2,0001"
            },
            {
                "id": 6,
                "content": "Definisi limit secara formal adalah $f'(a) = \\lim\\limits_{h \\to 0} \\frac{f(a+h) - f(a)}{h}$, dengan h mendekati 0",
                "type": "none",
                "question": "multiple-choice",
                "soal": "Apa yang terjadi jika limit tidak ada?",
                "opsi": [
                    "Turunan tidak terdefinisi pada titik tersebut.",
                    "Turunan sama dengan nol pada titik tersebut.",
                    "Turunan adalah tak terhingga pada titik tersebut.",
                    "Turunan adalah bilangan bulat pada titik tersebut."
                ],
                "jawaban": "Turunan tidak terdefinisi pada titik tersebut."
            },
            {
                "id": 7,
                "content": "Turunan ada jika limit definisi ada (tidak ada diskontinuitas).",
                "type": "none",
                "question": "multiple-choice",
                "soal": "Berikut ini adalah hal yang membuat turunan ada, kecuali...",
                "opsi": [
                    "Limit definisi ada.",
                    "Tidak berada dalam titik diskontinuitas.",
                    "Fungsi kontinu pada titik tersebut.",
                    "Titik berada pada asimtot tegak."
                ],
                "jawaban": "Titik berada pada asimtot tegak."
            }
        ];

        let currentSlide = 0;
        let selectedAnswer = null;
        let isCorrect = false;

        function updateProgressBar() {
            const progress = ((currentSlide + 1) / slidesData.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
        }

        function renderLatex() {
            if (window.renderMathInElement) {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "$", right: "$", display: false}
                    ]
                });
            }
        }

        function renderSlide() {
            const slide = slidesData[currentSlide];
            const contentContainer = document.getElementById('content-container');
            
            // Fade out
            contentContainer.style.opacity = '0';
            
            setTimeout(() => {
                // Update content
                document.getElementById('slide-content').innerHTML = slide.content;
                
                // Handle question section
                const questionSection = document.getElementById('question-section');
                const questionText = document.getElementById('question-text');
                const optionsContainer = document.getElementById('options-container');
                const feedback = document.getElementById('feedback');
                
                if (slide.question === 'multiple-choice') {
                    questionSection.classList.remove('hidden');
                    
                    // Set question text
                    if (slide.soal) {
                        questionText.textContent = slide.soal;
                        questionText.classList.remove('hidden');
                    } else {
                        questionText.classList.add('hidden');
                    }
                    
                    // Render options
                    optionsContainer.innerHTML = '';
                    slide.opsi.forEach((option, index) => {
                        const button = document.createElement('button');
                        button.className = 'w-full p-4 text-left rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all cursor-pointer';
                        button.textContent = option;
                        button.onclick = () => handleAnswerSelect(option, button);
                        optionsContainer.appendChild(button);
                    });
                    
                    feedback.classList.add('hidden');
                } else {
                    questionSection.classList.add('hidden');
                }
                
                // Handle graph section
                const graphSection = document.getElementById('graph-section');
                const graphLink = document.getElementById('graph-link');
                
                if (slide.type === 'graph') {
                    graphSection.classList.remove('hidden');
                    graphLink.href = slide.graph;
                } else {
                    graphSection.classList.add('hidden');
                }
                
                // Update next button
                updateNextButton();
                
                // Render LaTeX
                setTimeout(renderLatex, 100);
                
                // Fade in
                contentContainer.style.opacity = '1';
            }, 300);
            
            updateProgressBar();
        }

        function handleAnswerSelect(option, buttonElement) {
            const slide = slidesData[currentSlide];
            const feedback = document.getElementById('feedback');
            const optionsContainer = document.getElementById('options-container');
            
            // Reset all buttons
            const buttons = optionsContainer.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.className = 'w-full p-4 text-left rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all cursor-pointer';
            });
            
            selectedAnswer = option;
            
            if (option === slide.jawaban) {
                isCorrect = true;
                buttonElement.className = 'w-full p-4 text-left rounded-lg border-2 border-green-500 bg-green-50 transition-all';
                feedback.className = 'mt-4 p-4 rounded-lg flex items-center gap-2 bg-green-100 text-green-800';
                feedback.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="font-semibold">Benar! Jawaban Anda tepat.</span>
                `;
                feedback.classList.remove('hidden');
            } else {
                isCorrect = false;
                buttonElement.className = 'w-full p-4 text-left rounded-lg border-2 border-red-500 bg-red-50 transition-all';
                feedback.className = 'mt-4 p-4 rounded-lg flex items-center gap-2 bg-red-100 text-red-800';
                feedback.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="font-semibold">Salah, coba lagi.</span>
                `;
                feedback.classList.remove('hidden');
            }
            
            updateNextButton();
        }

        function updateNextButton() {
            const slide = slidesData[currentSlide];
            const nextBtn = document.getElementById('next-btn');
            const canProceed = slide.question === 'none' || isCorrect;
            
            if (canProceed) {
                nextBtn.disabled = false;
                nextBtn.className = 'px-8 py-3 rounded-lg text-white font-medium transition-all cursor-pointer';
                nextBtn.style.backgroundColor = '#528cbd';
                nextBtn.onmouseover = () => nextBtn.style.backgroundColor = '#3dbaf9';
                nextBtn.onmouseout = () => nextBtn.style.backgroundColor = '#528cbd';
            } else {
                nextBtn.disabled = true;
                nextBtn.className = 'px-8 py-3 rounded-lg text-white font-medium transition-all cursor-not-allowed opacity-50';
                nextBtn.style.backgroundColor = '#8eb7db';
                nextBtn.onmouseover = null;
                nextBtn.onmouseout = null;
            }
            
            if (currentSlide === slidesData.length - 1) {
                nextBtn.textContent = 'Selesai';
            } else {
                nextBtn.textContent = 'Next';
            }
        }

        function handleNext() {
            const slide = slidesData[currentSlide];
            const canProceed = slide.question === 'none' || isCorrect;
            
            if (!canProceed) return;
            
            if (currentSlide === slidesData.length - 1) {
                let userID = localStorage.getItem('userCurrentLevelId');
                if(userID == stage) {
                    localStorage.setItem('userCurrentLevelId', 2);
                }

                window.location.href = "../../main.html";
            } else {
                currentSlide++;
                selectedAnswer = null;
                isCorrect = false;
                renderSlide();
            }
        }

        // Initialize
        document.getElementById('next-btn').onclick = handleNext;
        document.getElementById('content-container').style.transition = 'opacity 300ms';
        
        // Wait for KaTeX to load
        window.addEventListener('load', () => {
            setTimeout(() => {
                renderSlide();
            }, 100);
        });
    </script>
</body>
</html>
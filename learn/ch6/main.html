<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pembelajaran Slide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        .fade-enter {
            opacity: 0;
        }
        .fade-enter-active {
            opacity: 1;
            transition: opacity 300ms;
        }
        .fade-exit {
            opacity: 1;
        }
        .fade-exit-active {
            opacity: 0;
            transition: opacity 300ms;
        }
    </style>
</head>
<body style="background-color: #f5f8fa; color: #040607;">
    <!-- Progress Bar -->
    <div class="w-full h-3" style="background-color: #e0e0e0;">
        <div id="progress-bar" class="h-full transition-all duration-500" style="width: 0%; background-color: #528cbd;"></div>
    </div>

    <!-- Main Content -->
    <div id="content-container" class="min-h-screen flex flex-col items-center justify-center p-8">
        <div class="max-w-3xl w-full">
            <!-- Content Text -->
            <div id="slide-content" class="text-lg leading-relaxed mb-8"></div>

            <!-- Question Section -->
            <div id="question-section" class="mb-8 hidden">
                <h3 id="question-text" class="text-xl font-semibold mb-4"></h3>
                <div id="options-container" class="space-y-3"></div>
                
                <!-- Feedback -->
                <div id="feedback" class="mt-4 p-4 rounded-lg flex items-center gap-2 hidden"></div>
            </div>

            <!-- Graph Link -->
            <div id="graph-section" class="mb-8 hidden">
                <a id="graph-link" href="#" target="_blank" rel="noopener noreferrer" 
                   class="inline-block px-6 py-3 rounded-lg text-white font-medium transition-colors"
                   style="background-color: #528cbd;">
                    Buka Grafik Desmos
                </a>
            </div>

            <!-- Next Button -->
            <div class="flex justify-end">
                <button id="next-btn" 
                        class="px-8 py-3 rounded-lg text-white font-medium transition-all cursor-not-allowed opacity-50"
                        style="background-color: #8eb7db;">
                    Next
                </button>
            </div>
        </div>
    </div>

    <script>
        let stage = 8;
        
        const slidesData = [
    {
        "id": 1,
        "content": "Bab: Turunan – Aturan Rantai (Chain Rule)<br>Pada bab ini kamu akan mempelajari bagaimana cara menurunkan fungsi berlapis (fungsi dalam fungsi).<br>Tujuan Pembelajaran:<br>- Memahami fungsi komposisi.<br>- Mempelajari rumus chain rule.<br>- Menyelesaikan contoh dasar hingga menengah.<br>- Menggunakan chain rule dalam konteks nyata.",
        "type": "none",
        "question": "multiple-choice",
        "soal": "Manakah contoh fungsi yang merupakan fungsi berlapis?",
        "opsi": [
            "y = (3x + 2)^5",
            "y = 5x + 3",
            "y = x^2 - 1",
            "y = 2x"
        ],
        "jawaban": "y = (3x + 2)^5"
    },
    {
        "id": 2,
        "content": "Aturan rantai menyatakan bahwa jika y = f(g(x)), maka turunannya adalah:<br>$y' = f'(g(x)) \\cdot g'(x)$<br>Makna rumus:<br>- Turunkan fungsi luar, tetap masukkan fungsi dalam.<br>- Kalikan dengan turunan fungsi dalam.<br>Contoh:<br>y = (3x+2)^5 → fungsi luar = u^5, fungsi dalam = 3x+2 → turunan = 5(3x+2)^4·3",
        "type": "none",
        "question": "multiple-choice",
        "soal": "Manakah pasangan konsep yang benar?",
        "opsi": [
            "Fungsi luar → f(u)",
            "Fungsi luar → g(x)",
            "Turunan dalam → f'(u)",
            "Fungsi dalam → f(x)"
        ],
        "jawaban": "Fungsi luar → f(u)"
    },
    {
        "id": 3,
        "content": "Identifikasi fungsi luar dan dalam:<br>Contoh: y = √(5x² + 1)<br>Fungsi luar = √u<br>Fungsi dalam = 5x² + 1<br>Turunan: y' = 1/(2√(5x²+1)) · 10x",
        "type": "none",
        "question": "multiple-choice",
        "soal": "Apa fungsi dalam dari (7x – 4)^9?",
        "opsi": [
            "7x – 4",
            "9",
            "x² – 4",
            "(7x – 4)^8"
        ],
        "jawaban": "7x – 4"
    },
    {
        "id": 4,
        "content": "Contoh dasar langkah penuh:<br>Turunkan y = (2x³ – x + 1)^4<br>Langkah:<br>1. Fungsi luar = u^4<br>2. Fungsi dalam = 2x³ – x + 1<br>3. Turunan luar = 4u^3<br>4. Turunan dalam = 6x² – 1<br>Hasil: y' = 4(2x³ – x + 1)^3 (6x² – 1)",
        "type": "none",
        "question": "multiple-choice",
        "soal": "Manakah isian yang benar untuk fungsi luar, turunan luar, fungsi dalam, dan turunannya?",
        "opsi": [
            "Fungsi luar = u^4, Turunan luar = 4u^3, Fungsi dalam = 2x³ – x + 1, Turunan dalam = 6x² – 1",
            "Fungsi luar = u³, Turunan luar = 3u², Fungsi dalam = 2x – 1, Turunan dalam = 2",
            "Fungsi luar = x^4, Turunan luar = 4x³, Fungsi dalam = x, Turunan dalam = 1",
            "Fungsi luar = √u, Turunan luar = 1/(2√u), Fungsi dalam = 2x³ – x + 1, Turunan dalam = 6x² – 1"
        ],
        "jawaban": "Fungsi luar = u^4, Turunan luar = 4u^3, Fungsi dalam = 2x³ – x + 1, Turunan dalam = 6x² – 1"
    },
    {
        "id": 5,
        "content": "Contoh soal menengah:<br>Turunkan y = sin(4x² + 3x)<br>Fungsi luar = sin(u) → turunan = cos(u)<br>Fungsi dalam = 4x² + 3x → turunan = 8x + 3<br>Hasil: y' = cos(4x² + 3x)(8x + 3)",
        "type": "none",
        "question": "multiple-choice",
        "soal": "Manakah turunan yang benar untuk y = sin(4x² + 3x)?",
        "opsi": [
            "cos(4x² + 3x)(8x + 3)",
            "sin(4x² + 3x)(8x + 3)",
            "cos(4x² + 3x)(4x² + 3x)",
            "(8x + 3)sin(4x² + 3x)"
        ],
        "jawaban": "cos(4x² + 3x)(8x + 3)"
    },
    {
        "id": 6,
        "content": "Chain rule bertingkat:<br>Turunkan y = e^((3x² +1)^5)<br>Lapisan 1: e^u → turunan = e^u<br>Lapisan 2: u = v^5 → turunan = 5v^4<br>Lapisan 3: v = 3x² +1 → turunan = 6x<br>Hasil akhir: y' = e^((3x²+1)^5) · 5(3x²+1)^4 · 6x",
        "type": "none",
        "question": "multiple-choice",
        "soal": "Manakah urutan lapisan yang benar?",
        "opsi": [
            "e^(...) → (...)^5 → 3x²+1",
            "(...)^5 → e^(...) → 3x²+1",
            "3x²+1 → e^(...) → (...)^5",
            "3x²+1 → (...)^5 → e^(...)"
        ],
        "jawaban": "e^(...) → (...)^5 → 3x²+1"
    },
    {
        "id": 7,
        "content": "Aplikasi kontekstual:<br>T(t) = ln(2t² + 3)<br>Fungsi luar = ln(u) → turunan = 1/u<br>Fungsi dalam = 2t² + 3 → turunan = 4t<br>Hasil: T'(t) = 4t / (2t² + 3)",
        "type": "none",
        "question": "multiple-choice",
        "soal": "Benar atau salah: Turunan ln(5x+1) adalah 5/(5x+1).",
        "opsi": [
            "Benar",
            "Salah"
        ],
        "jawaban": "Benar"
    },
    {
        "id": 8,
        "content": "Evaluasi akhir – Kuis Akhir:<br>1. (5x+2)^6 → 6(5x+2)^5·5<br>2. cos(3x–1) → -sin(3x–1)·3<br>3. Fungsi luar dari (7x³ - x)^9 adalah u^9<br>4. Chain rule = turunan luar × turunan dalam.",
        "type": "none",
        "question": "multiple-choice",
        "soal": "Manakah pernyataan berikut yang benar?",
        "opsi": [
            "Chain rule adalah turunan fungsi luar dikali turunan fungsi dalam.",
            "Chain rule hanya menurunkan fungsi dalam.",
            "Chain rule hanya berlaku untuk fungsi linear.",
            "Chain rule sama dengan quotient rule."
        ],
        "jawaban": "Chain rule adalah turunan fungsi luar dikali turunan fungsi dalam."
    }
]

        let currentSlide = 0;
        let selectedAnswer = null;
        let isCorrect = false;

        function updateProgressBar() {
            const progress = ((currentSlide + 1) / slidesData.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
        }

        function renderLatex() {
            if (window.renderMathInElement) {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "$", right: "$", display: false}
                    ]
                });
            }
        }

        function renderSlide() {
            const slide = slidesData[currentSlide];
            const contentContainer = document.getElementById('content-container');
            
            // Fade out
            contentContainer.style.opacity = '0';
            
            setTimeout(() => {
                // Update content
                document.getElementById('slide-content').innerHTML = slide.content;
                
                // Handle question section
                const questionSection = document.getElementById('question-section');
                const questionText = document.getElementById('question-text');
                const optionsContainer = document.getElementById('options-container');
                const feedback = document.getElementById('feedback');
                
                if (slide.question === 'multiple-choice') {
                    questionSection.classList.remove('hidden');
                    
                    // Set question text
                    if (slide.soal) {
                        questionText.textContent = slide.soal;
                        questionText.classList.remove('hidden');
                    } else {
                        questionText.classList.add('hidden');
                    }
                    
                    // Render options
                    optionsContainer.innerHTML = '';
                    slide.opsi.forEach((option, index) => {
                        const button = document.createElement('button');
                        button.className = 'w-full p-4 text-left rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all cursor-pointer';
                        button.textContent = option;
                        button.onclick = () => handleAnswerSelect(option, button);
                        optionsContainer.appendChild(button);
                    });
                    
                    feedback.classList.add('hidden');
                } else {
                    questionSection.classList.add('hidden');
                }
                
                // Handle graph section
                const graphSection = document.getElementById('graph-section');
                const graphLink = document.getElementById('graph-link');
                
                if (slide.type === 'graph') {
                    graphSection.classList.remove('hidden');
                    graphLink.href = slide.graph;
                } else {
                    graphSection.classList.add('hidden');
                }
                
                // Update next button
                updateNextButton();
                
                // Render LaTeX
                setTimeout(renderLatex, 100);
                
                // Fade in
                contentContainer.style.opacity = '1';
            }, 300);
            
            updateProgressBar();
        }

        function handleAnswerSelect(option, buttonElement) {
            const slide = slidesData[currentSlide];
            const feedback = document.getElementById('feedback');
            const optionsContainer = document.getElementById('options-container');
            
            // Reset all buttons
            const buttons = optionsContainer.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.className = 'w-full p-4 text-left rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all cursor-pointer';
            });
            
            selectedAnswer = option;
            
            if (option === slide.jawaban) {
                isCorrect = true;
                buttonElement.className = 'w-full p-4 text-left rounded-lg border-2 border-green-500 bg-green-50 transition-all';
                feedback.className = 'mt-4 p-4 rounded-lg flex items-center gap-2 bg-green-100 text-green-800';
                feedback.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="font-semibold">Benar! Jawaban Anda tepat.</span>
                `;
                feedback.classList.remove('hidden');
            } else {
                isCorrect = false;
                buttonElement.className = 'w-full p-4 text-left rounded-lg border-2 border-red-500 bg-red-50 transition-all';
                feedback.className = 'mt-4 p-4 rounded-lg flex items-center gap-2 bg-red-100 text-red-800';
                feedback.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="font-semibold">Salah, coba lagi.</span>
                `;
                feedback.classList.remove('hidden');
            }
            
            updateNextButton();
        }

        function updateNextButton() {
            const slide = slidesData[currentSlide];
            const nextBtn = document.getElementById('next-btn');
            const canProceed = slide.question === 'none' || isCorrect;
            
            if (canProceed) {
                nextBtn.disabled = false;
                nextBtn.className = 'px-8 py-3 rounded-lg text-white font-medium transition-all cursor-pointer';
                nextBtn.style.backgroundColor = '#528cbd';
                nextBtn.onmouseover = () => nextBtn.style.backgroundColor = '#3dbaf9';
                nextBtn.onmouseout = () => nextBtn.style.backgroundColor = '#528cbd';
            } else {
                nextBtn.disabled = true;
                nextBtn.className = 'px-8 py-3 rounded-lg text-white font-medium transition-all cursor-not-allowed opacity-50';
                nextBtn.style.backgroundColor = '#8eb7db';
                nextBtn.onmouseover = null;
                nextBtn.onmouseout = null;
            }
            
            if (currentSlide === slidesData.length - 1) {
                nextBtn.textContent = 'Selesai';
            } else {
                nextBtn.textContent = 'Next';
            }
        }

        function handleNext() {
            const slide = slidesData[currentSlide];
            const canProceed = slide.question === 'none' || isCorrect;
            
            if (!canProceed) return;
            
            if (currentSlide === slidesData.length - 1) {
                let userID = localStorage.getItem('userCurrentLevelId');
                if(userID == stage) {
                    localStorage.setItem('userCurrentLevelId', stage + 1);
                }

                window.location.href = "../../main.html";
            } else {
                currentSlide++;
                selectedAnswer = null;
                isCorrect = false;
                renderSlide();
            }
        }

        // Initialize
        document.getElementById('next-btn').onclick = handleNext;
        document.getElementById('content-container').style.transition = 'opacity 300ms';
        
        // Wait for KaTeX to load
        window.addEventListener('load', () => {
            setTimeout(() => {
                renderSlide();
            }, 100);
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pembelajaran Slide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        .fade-enter {
            opacity: 0;
        }
        .fade-enter-active {
            opacity: 1;
            transition: opacity 300ms;
        }
        .fade-exit {
            opacity: 1;
        }
        .fade-exit-active {
            opacity: 0;
            transition: opacity 300ms;
        }
    </style>
</head>
<body style="background-color: #f5f8fa; color: #040607;">
    <!-- Progress Bar -->
    <div class="w-full h-3" style="background-color: #e0e0e0;">
        <div id="progress-bar" class="h-full transition-all duration-500" style="width: 0%; background-color: #528cbd;"></div>
    </div>

    <!-- Main Content -->
    <div id="content-container" class="min-h-screen flex flex-col items-center justify-center p-8">
        <div class="max-w-3xl w-full">
            <!-- Content Text -->
            <div id="slide-content" class="text-lg leading-relaxed mb-8"></div>

            <!-- Question Section -->
            <div id="question-section" class="mb-8 hidden">
                <h3 id="question-text" class="text-xl font-semibold mb-4"></h3>
                <div id="options-container" class="space-y-3"></div>
                
                <!-- Feedback -->
                <div id="feedback" class="mt-4 p-4 rounded-lg flex items-center gap-2 hidden"></div>
            </div>

            <!-- Graph Link -->
            <div id="graph-section" class="mb-8 hidden">
                <a id="graph-link" href="#" target="_blank" rel="noopener noreferrer" 
                   class="inline-block px-6 py-3 rounded-lg text-white font-medium transition-colors"
                   style="background-color: #528cbd;">
                    Buka Grafik Desmos
                </a>
            </div>

            <!-- Next Button -->
            <div class="flex justify-end">
                <button id="next-btn" 
                        class="px-8 py-3 rounded-lg text-white font-medium transition-all cursor-not-allowed opacity-50"
                        style="background-color: #8eb7db;">
                    Next
                </button>
            </div>
        </div>
    </div>

    <script>
        let stage = 5;
        
        const slidesData = [
        {
            "id": 1,
            "content": "Bab: Turunan<br>Bagian: Aturan Perkalian<br>Setelah menyelesaikan bagian ini, kamu akan mampu memahami aturan dasar turunan perkalian dan menggunakannya pada soal-soal polinomial.",
            "type": "none",
            "question": "none"
        },
        {
            "id": 2,
            "content": "Sebelum mempelajari aturan perkalian, pastikan kamu memahami tiga konsep dasar:<br>1. Definisi turunan: $f'(x) = lim(h→0) \\frac{f(x+h)-f(x)}{h}$<br>2. Aturan perpangkatan: $(x^n)' = nx^{n-1}$<br>3. Aturan penjumlahan: $(u+v)' = u' + v'$<br>Konsep ini akan membantu kamu memahami kenapa turunan perkalian tidak sesederhana terlihat.",
            "type": "none",
            "question": "multiple-choice",
            "soal": "Jika $f(x) = 3x^2 + 2x$, maka $f'(x)$ adalah…",
            "opsi": [
                "$6x + 2$",
                "$3x + 2$",
                "$3x^2$",
                "$5x$"
            ],
            "jawaban": "$6x + 2$"
        },
        {
            "id": 3,
            "content": "Banyak siswa mengira turunan perkalian sama dengan mengalikan kedua turunannya. Itu salah.<br>Contoh: $f(x) = (x^2)(x^3)$<br>Beberapa siswa menyangka $f'(x)=2x·3x^2=6x^3$. Padahal $x^2·x^3=x^5$ sehingga turunan yang benar adalah $5x^4$. Hasilnya berbeda, sehingga aturan tersebut tidak berlaku.",
            "type": "none",
            "question": "multiple-choice",
            "soal": "Mengapa $(u·v)'$ tidak sama dengan $u'·v'$?",
            "opsi": [
                "Karena turunan adalah operasi non-linear",
                "Karena definisi limit menghasilkan suku tambahan",
                "Karena u dan v saling meniadakan",
                "Karena u dan v harus sama agar bisa dikalikan"
            ],
            "jawaban": "Karena definisi limit menghasilkan suku tambahan"
        },
        {
            "id": 4,
            "content": "Aturan perkalian digunakan ketika kita menurunkan fungsi yang merupakan hasil perkalian dua fungsi.<br>Jika $f(x) = u(x)v(x)$, maka:<br>$f'(x) = u'(x)v(x) + u(x)v'(x)$",
            "type": "none",
            "question": "multiple-choice",
            "soal": "Jika $u(x)=x$ dan $v(x)=x^2$, maka nilai $u'(x)$ dan $v'(x)$ adalah…",
            "opsi": [
                "$u’(x)=1$ dan $v’(x)=2x$",
                "$u’(x)=x$ dan $v’(x)=2$",
                "$u’(x)=2x$ dan $v’(x)=1$",
                "$u’(x)=0$ dan $v’(x)=2x$"
            ],
            "jawaban": "$u’(x)=1$ dan $v’(x)=2x$"
        },
        {
            "id": 5,
            "content": "Contoh fungsi polinomial menggunakan aturan perkalian:<br>$f(x) = x^2(3x+1)$<br>Dengan:<br>$u(x)=x^2 → u'(x)=2x$<br>$v(x)=3x+1 → v'(x)=3$<br>Maka:<br>$f'(x)= (2x)(3x+1) + (x^2)(3)$<br>Fokuskan pada struktur aturan: turunkan satu fungsi, pertahankan yang lain.",
            "type": "none",
            "question": "multiple-choice",
            "soal": "Turunan dari $f(x)=x(4x^2 - 2)$ adalah…",
            "opsi": [
                "$4x^2 - 2 + x(8x)$",
                "$4x^2 - 2$",
                "$8x^2 + 4x$",
                "$1 + 8x^2$"
            ],
            "jawaban": "$4x^2 - 2 + x(8x)$"
        },
        {
            "id": 6,
            "content": "Aturan perkalian tiga fungsi digunakan jika suatu fungsi merupakan gabungan dari tiga faktor.<br>Jika $f(x)=u(x)v(x)w(x)$, maka:<br>$f'(x)=u'vw + uv'w + uvw'$<br>Contoh:<br>$f(x)=x(x+1)(2x-3)$",
            "type": "none",
            "question": "multiple-choice",
            "soal": "Manakah bagian yang merupakan turunan dari $u'(x)$ untuk contoh di atas?",
            "opsi": [
                "x(x+1)·2",
                "1·(x+1)(2x-3)",
                "x·1·(2x-3)",
                "Semua benar"
            ],
            "jawaban": "1·(x+1)(2x-3)"
        },
        {
            "id": 7,
            "content": "Latihan akhir:<br>Gunakan aturan perkalian untuk menyelesaikan turunan berikut:<br>1. $(3x+1)x^2$<br>2. $x^2(5x^3-1)$<br>3. $(x-2)(x+4)$",
            "type": "none",
            "question": "multiple-choice",
            "soal": "Manakah turunan yang benar untuk $(x-2)(x+4)$?",
            "opsi": [
                "$1(x+4) + (x-2)(1)$",
                "$2x + 4$",
                "$x^2 + 2x - 8$",
                "$1$"
            ],
            "jawaban": "$1(x+4) + (x-2)(1)$"
        }
    ]


        let currentSlide = 0;
        let selectedAnswer = null;
        let isCorrect = false;

        function updateProgressBar() {
            const progress = ((currentSlide + 1) / slidesData.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
        }

        function renderLatex() {
            if (window.renderMathInElement) {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "$", right: "$", display: false}
                    ]
                });
            }
        }

        function renderSlide() {
            const slide = slidesData[currentSlide];
            const contentContainer = document.getElementById('content-container');
            
            // Fade out
            contentContainer.style.opacity = '0';
            
            setTimeout(() => {
                // Update content
                document.getElementById('slide-content').innerHTML = slide.content;
                
                // Handle question section
                const questionSection = document.getElementById('question-section');
                const questionText = document.getElementById('question-text');
                const optionsContainer = document.getElementById('options-container');
                const feedback = document.getElementById('feedback');
                
                if (slide.question === 'multiple-choice') {
                    questionSection.classList.remove('hidden');
                    
                    // Set question text
                    if (slide.soal) {
                        questionText.textContent = slide.soal;
                        questionText.classList.remove('hidden');
                    } else {
                        questionText.classList.add('hidden');
                    }
                    
                    // Render options
                    optionsContainer.innerHTML = '';
                    slide.opsi.forEach((option, index) => {
                        const button = document.createElement('button');
                        button.className = 'w-full p-4 text-left rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all cursor-pointer';
                        button.textContent = option;
                        button.onclick = () => handleAnswerSelect(option, button);
                        optionsContainer.appendChild(button);
                    });
                    
                    feedback.classList.add('hidden');
                } else {
                    questionSection.classList.add('hidden');
                }
                
                // Handle graph section
                const graphSection = document.getElementById('graph-section');
                const graphLink = document.getElementById('graph-link');
                
                if (slide.type === 'graph') {
                    graphSection.classList.remove('hidden');
                    graphLink.href = slide.graph;
                } else {
                    graphSection.classList.add('hidden');
                }
                
                // Update next button
                updateNextButton();
                
                // Render LaTeX
                setTimeout(renderLatex, 100);
                
                // Fade in
                contentContainer.style.opacity = '1';
            }, 300);
            
            updateProgressBar();
        }

        function handleAnswerSelect(option, buttonElement) {
            const slide = slidesData[currentSlide];
            const feedback = document.getElementById('feedback');
            const optionsContainer = document.getElementById('options-container');
            
            // Reset all buttons
            const buttons = optionsContainer.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.className = 'w-full p-4 text-left rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all cursor-pointer';
            });
            
            selectedAnswer = option;
            
            if (option === slide.jawaban) {
                isCorrect = true;
                buttonElement.className = 'w-full p-4 text-left rounded-lg border-2 border-green-500 bg-green-50 transition-all';
                feedback.className = 'mt-4 p-4 rounded-lg flex items-center gap-2 bg-green-100 text-green-800';
                feedback.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="font-semibold">Benar! Jawaban Anda tepat.</span>
                `;
                feedback.classList.remove('hidden');
            } else {
                isCorrect = false;
                buttonElement.className = 'w-full p-4 text-left rounded-lg border-2 border-red-500 bg-red-50 transition-all';
                feedback.className = 'mt-4 p-4 rounded-lg flex items-center gap-2 bg-red-100 text-red-800';
                feedback.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="font-semibold">Salah, coba lagi.</span>
                `;
                feedback.classList.remove('hidden');
            }
            
            updateNextButton();
        }

        function updateNextButton() {
            const slide = slidesData[currentSlide];
            const nextBtn = document.getElementById('next-btn');
            const canProceed = slide.question === 'none' || isCorrect;
            
            if (canProceed) {
                nextBtn.disabled = false;
                nextBtn.className = 'px-8 py-3 rounded-lg text-white font-medium transition-all cursor-pointer';
                nextBtn.style.backgroundColor = '#528cbd';
                nextBtn.onmouseover = () => nextBtn.style.backgroundColor = '#3dbaf9';
                nextBtn.onmouseout = () => nextBtn.style.backgroundColor = '#528cbd';
            } else {
                nextBtn.disabled = true;
                nextBtn.className = 'px-8 py-3 rounded-lg text-white font-medium transition-all cursor-not-allowed opacity-50';
                nextBtn.style.backgroundColor = '#8eb7db';
                nextBtn.onmouseover = null;
                nextBtn.onmouseout = null;
            }
            
            if (currentSlide === slidesData.length - 1) {
                nextBtn.textContent = 'Selesai';
            } else {
                nextBtn.textContent = 'Next';
            }
        }

        function handleNext() {
            const slide = slidesData[currentSlide];
            const canProceed = slide.question === 'none' || isCorrect;
            
            if (!canProceed) return;
            
            if (currentSlide === slidesData.length - 1) {
                let userID = localStorage.getItem('userCurrentLevelId');
                if(userID == stage) {
                    localStorage.setItem('userCurrentLevelId', stage + 1);
                }

                window.location.href = "../../main.html";
            } else {
                currentSlide++;
                selectedAnswer = null;
                isCorrect = false;
                renderSlide();
            }
        }

        // Initialize
        document.getElementById('next-btn').onclick = handleNext;
        document.getElementById('content-container').style.transition = 'opacity 300ms';
        
        // Wait for KaTeX to load
        window.addEventListener('load', () => {
            setTimeout(() => {
                renderSlide();
            }, 100);
        });
    </script>
</body>
</html>